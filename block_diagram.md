Даю ссылку на блок-схему основной части решения задачи
https://app.diagrams.net/#G1uWfR33gPvl6KU86G-yX7ULU2fK8V72ov